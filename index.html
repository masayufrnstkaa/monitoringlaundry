<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Keuangan Laundry</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
         :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --bg-color: #ecf0f1;
            --card-bg: #ffffff;
            --text-dark: #333;
            --text-light: #f8f9fa;
            --shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: var(--text-light);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        header h1 {
            margin: 0;
            font-weight: 700;
        }
        
        .container {
            padding: 2rem 1rem;
            max-width: 1300px;
            margin: 0 auto;
        }
        
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (min-width: 768px) {
            .cards {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .card {
            color: var(--text-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            border: none;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
        }
        
        .card h4,
        .card p,
        .card-icon {
            color: var(--text-light);
        }
        
        .card h4 {
            margin: 0 0 0.5rem;
            font-weight: 600;
        }
        
        .card p {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .card-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        #pendapatanHarian.card {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
        }
        
        #pendapatanBulanan.card {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        
        #penghasilanBersih.card {
            background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%);
        }
        
        #pendapatanTahunan.card {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
        }
        
        #pengeluaranBulanan.card {
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
        }
        
        #pendapatanTotal.card {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }
        
        .form-section {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .form-section h3 {
            margin-top: 0;
            font-weight: 600;
            color: var(--secondary-color);
        }
        /* New styles for side-by-side forms */
        
        .form-container-wrapper {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .form-container {
            flex: 1;
            min-width: 300px;
        }
        
        .form-toggle {
            cursor: pointer;
            padding: 1rem;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .form-toggle:hover {
            background-color: #e9ecef;
        }
        
        .form-toggle i {
            transition: transform 0.3s ease;
        }
        
        .form-toggle.active i {
            transform: rotate(180deg);
        }
        
        form {
            display: none;
            /* Initially hide the forms */
        }
        
        form.active {
            display: grid;
        }
        
        form {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: center;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        button {
            width: 100%;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            cursor: pointer;
            border: none;
            color: var(--text-light);
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1rem;
        }
        
        #laundryForm button {
            background: var(--primary-color);
        }
        
        #laundryForm button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        #pengeluaranForm button {
            background: #e67e22;
        }
        
        #pengeluaranForm button:hover {
            background: #d35400;
            transform: translateY(-2px);
        }
        
        #downloadBtn {
            background: #27ae60;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: inline-block;
        }
        
        #downloadBtn:hover {
            background: #2ecc71;
            transform: translateY(-2px);
        }
        
        .table-section {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        
        .table-section h3 {
            margin-top: 0;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        
        table th,
        table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        table thead tr {
            background-color: #f5f5f5;
        }
        
        table th {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        table tbody tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-buttons button {
            padding: 0.5rem 0.8rem;
            font-size: 0.85rem;
            margin-top: 0;
        }
        
        .edit {
            background: #f39c12;
        }
        
        .edit:hover {
            background: #e67e22;
        }
        
        .delete {
            background: #e74c3c;
        }
        
        .delete:hover {
            background: #c0392b;
        }
        
        .whatsapp {
            background: #25d366;
        }
        
        .whatsapp:hover {
            background: #128c7e;
        }
        
        @media (max-width: 768px) {
            .cards,
            .form-container-wrapper {
                grid-template-columns: 1fr;
                flex-direction: column;
            }
            .form-container {
                min-width: 100%;
            }
            form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Dashboard Keuangan Laundry üß∫</h1>
        <p>Kelola pemasukan dan pengeluaran bisnismu dengan lebih mudah.</p>
    </header>

    <div class="container">
        <div class="cards">
            <div class="card" id="pendapatanHarian">
                <i class="fas fa-sun card-icon"></i>
                <h4>Pendapatan Harian</h4>
                <p>Rp 0</p>
            </div>
            <div class="card" id="pendapatanBulanan">
                <i class="fas fa-calendar-week card-icon"></i>
                <h4>Pendapatan Bulanan</h4>
                <p>Rp 0</p>
            </div>
            <div class="card" id="penghasilanBersih">
                <i class="fas fa-chart-line card-icon"></i>
                <h4>Penghasilan Bersih Bulanan</h4>
                <p>Rp 0</p>
            </div>
            <div class="card" id="pendapatanTahunan">
                <i class="fas fa-calendar-alt card-icon"></i>
                <h4>Pendapatan Tahunan</h4>
                <p>Rp 0</p>
            </div>
            <div class="card" id="pengeluaranBulanan">
                <i class="fas fa-hand-holding-usd card-icon"></i>
                <h4>Pengeluaran Bulanan</h4>
                <p>Rp 0</p>
            </div>
            <div class="card" id="pendapatanTotal">
                <i class="fas fa-money-bill-wave card-icon"></i>
                <h4>Pendapatan Total</h4>
                <p>Rp 0</p>
            </div>
        </div>

        <div class="form-section">
            <div class="form-container-wrapper">
                <div class="form-container">
                    <div class="form-toggle" id="toggleLaundryForm">
                        <h3>üìù Input Transaksi Laundry</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <form id="laundryForm">
                        <input type="hidden" id="editIndexLaundry">
                        <div class="form-group">
                            <label for="nama">Nama Pelanggan</label>
                            <input type="text" id="nama" placeholder="Contoh: Budi Santoso" required>
                        </div>
                        <div class="form-group">
                            <label for="nomor">Nomor WA</label>
                            <input type="text" id="nomor" placeholder="Contoh: 6281234567890" required>
                        </div>
                        <div class="form-group">
                            <label for="berat">Berat (Kg)</label>
                            <input type="text" id="berat" placeholder="Contoh: 5,5 atau 5.5" required>
                        </div>
                        <div class="form-group">
                            <label for="harga">Harga per Kg (Rp)</label>
                            <input type="number" id="harga" placeholder="Contoh: 7000" required>
                        </div>
                        <div class="form-group">
                            <label for="tanggal">Tanggal Transaksi</label>
                            <input type="date" id="tanggal" required>
                        </div>
                        <button type="submit">Simpan Transaksi</button>
                    </form>
                </div>

                <div class="form-container">
                    <div class="form-toggle" id="togglePengeluaranForm">
                        <h3>üí∞ Input Pengeluaran</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <form id="pengeluaranForm">
                        <input type="hidden" id="editIndexPengeluaran">
                        <div class="form-group">
                            <label for="ketPengeluaran">Keterangan</label>
                            <input type="text" id="ketPengeluaran" placeholder="Contoh: Beli sabun cuci" required>
                        </div>
                        <div class="form-group">
                            <label for="jumlahPengeluaran">Total Pengeluaran (Rp)</label>
                            <input type="number" id="jumlahPengeluaran" placeholder="Contoh: 50000" required>
                        </div>
                        <div class="form-group">
                            <label for="tanggalPengeluaran">Tanggal Pengeluaran</label>
                            <input type="date" id="tanggalPengeluaran" required>
                        </div>
                        <button type="submit">Simpan Pengeluaran</button>
                    </form>
                </div>
            </div>
        </div>

        <button id="downloadBtn">Download Data (.csv) <i class="fas fa-download"></i></button>

        <div class="table-section">
            <h3>üìä Data Transaksi Laundry</h3>
            <table id="laundryTable">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>No. WA</th>
                        <th>Berat (Kg)</th>
                        <th>Harga (Rp)</th>
                        <th>Total</th>
                        <th>Tanggal</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="table-section">
            <h3>üìä Data Pengeluaran</h3>
            <table id="pengeluaranTable">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Keterangan</th>
                        <th>Total (Rp)</th>
                        <th>Tanggal</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        let laundryData = JSON.parse(localStorage.getItem("laundryData")) || [];
        let pengeluaranData = JSON.parse(localStorage.getItem("pengeluaranData")) || [];

        const laundryForm = document.getElementById("laundryForm");
        const pengeluaranForm = document.getElementById("pengeluaranForm");
        const laundryBody = document.querySelector("#laundryTable tbody");
        const pengeluaranBody = document.querySelector("#pengeluaranTable tbody");
        const downloadBtn = document.getElementById("downloadBtn");

        const toggleLaundryForm = document.getElementById("toggleLaundryForm");
        const togglePengeluaranForm = document.getElementById("togglePengeluaranForm");

        function formatRupiah(angka) {
            return "Rp " + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function renderTable() {
            // Render Laundry
            laundryBody.innerHTML = "";
            let totalPendapatan = 0;
            let today = new Date().toISOString().split("T")[0];
            let bulan = new Date().getMonth();
            let tahun = new Date().getFullYear();
            let pendapatanHarian = 0,
                pendapatanBulanan = 0,
                pendapatanTahunan = 0;
            let totalPengeluaranBulanan = 0;

            laundryData.forEach((data, index) => {
                // Perbaikan: Menggunakan parseFloat() dan mengganti koma dengan titik
                const berat = parseFloat(data.berat.toString().replace(',', '.'));
                const harga = parseFloat(data.harga);
                const total = berat * harga;

                totalPendapatan += total;
                let tanggal = new Date(data.tanggal);

                if (data.tanggal === today) pendapatanHarian += total;
                if (tanggal.getMonth() === bulan && tanggal.getFullYear() === tahun) pendapatanBulanan += total;
                if (tanggal.getFullYear() === tahun) pendapatanTahunan += total;

                const row = `<tr>
            <td>${index + 1}</td>
            <td>${data.nama}</td>
            <td>${data.nomor}</td>
            <td>${data.berat}</td>
            <td>${formatRupiah(data.harga)}</td>
            <td>${formatRupiah(total)}</td>
            <td>${data.tanggal}</td>
            <td>
              <div class="action-buttons">
                <button class="edit" data-type="laundry" data-index="${index}"><i class="fas fa-edit"></i></button>
                <button class="delete" data-type="laundry" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                <button class="whatsapp" onclick="sendWA('${data.nomor}','${data.nama}')"><i class="fab fa-whatsapp"></i></button>
              </div>
            </td>
          </tr>`;
                laundryBody.innerHTML += row;
            });

            // Render Pengeluaran
            pengeluaranBody.innerHTML = "";
            pengeluaranData.forEach((data, index) => {
                let tanggal = new Date(data.tanggal);
                if (tanggal.getMonth() === bulan && tanggal.getFullYear() === tahun) {
                    totalPengeluaranBulanan += data.jumlah;
                }
                const row = `<tr>
            <td>${index + 1}</td>
            <td>${data.keterangan}</td>
            <td>${formatRupiah(data.jumlah)}</td>
            <td>${data.tanggal}</td>
            <td>
                <div class="action-buttons">
                    <button class="edit" data-type="pengeluaran" data-index="${index}"><i class="fas fa-edit"></i></button>
                    <button class="delete" data-type="pengeluaran" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                </div>
            </td>
          </tr>`;
                pengeluaranBody.innerHTML += row;
            });

            // Calculate net income
            const penghasilanBersih = pendapatanBulanan - totalPengeluaranBulanan;

            // Update Cards
            document.querySelector("#pendapatanHarian p").innerText = formatRupiah(pendapatanHarian);
            document.querySelector("#pendapatanBulanan p").innerText = formatRupiah(pendapatanBulanan);
            document.querySelector("#pendapatanTahunan p").innerText = formatRupiah(pendapatanTahunan);
            document.querySelector("#pendapatanTotal p").innerText = formatRupiah(totalPendapatan);
            document.querySelector("#pengeluaranBulanan p").innerText = formatRupiah(totalPengeluaranBulanan);
            document.querySelector("#penghasilanBersih p").innerText = formatRupiah(penghasilanBersih);

            localStorage.setItem("laundryData", JSON.stringify(laundryData));
            localStorage.setItem("pengeluaranData", JSON.stringify(pengeluaranData));
        }

        laundryForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const nama = document.getElementById("nama").value;
            const nomor = document.getElementById("nomor").value;
            // Perbaikan: Mengambil nilai dari input teks dan memprosesnya
            const berat = document.getElementById("berat").value.replace(',', '.');
            const harga = parseInt(document.getElementById("harga").value);
            const tanggal = document.getElementById("tanggal").value;
            const editIndex = document.getElementById("editIndexLaundry").value;

            const newData = {
                nama,
                nomor,
                berat, // Simpan sebagai string agar format koma/titik tetap
                harga,
                tanggal
            };

            if (editIndex === "") {
                laundryData.push(newData);
            } else {
                laundryData[editIndex] = newData;
                document.getElementById("editIndexLaundry").value = "";
            }

            laundryForm.reset();
            renderTable();
        });

        pengeluaranForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const keterangan = document.getElementById("ketPengeluaran").value;
            const jumlah = parseInt(document.getElementById("jumlahPengeluaran").value);
            const tanggal = document.getElementById("tanggalPengeluaran").value;
            const editIndex = document.getElementById("editIndexPengeluaran").value;

            const newData = {
                keterangan,
                jumlah,
                tanggal
            };

            if (editIndex === "") {
                pengeluaranData.push(newData);
            } else {
                pengeluaranData[editIndex] = newData;
                document.getElementById("editIndexPengeluaran").value = "";
            }

            pengeluaranForm.reset();
            renderTable();
        });

        function editLaundry(index) {
            const data = laundryData[index];
            document.getElementById("nama").value = data.nama;
            document.getElementById("nomor").value = data.nomor;
            document.getElementById("berat").value = data.berat;
            document.getElementById("harga").value = data.harga;
            document.getElementById("tanggal").value = data.tanggal;
            document.getElementById("editIndexLaundry").value = index;

            laundryForm.classList.add('active');
            toggleLaundryForm.classList.add('active');
            window.scrollTo({
                top: toggleLaundryForm.offsetTop,
                behavior: 'smooth'
            });
        }

        function deleteLaundry(index) {
            if (confirm("Yakin ingin menghapus data ini?")) {
                laundryData.splice(index, 1);
                renderTable();
            }
        }

        function editPengeluaran(index) {
            const data = pengeluaranData[index];
            document.getElementById("ketPengeluaran").value = data.keterangan;
            document.getElementById("jumlahPengeluaran").value = data.jumlah;
            document.getElementById("tanggalPengeluaran").value = data.tanggal;
            document.getElementById("editIndexPengeluaran").value = index;

            pengeluaranForm.classList.add('active');
            togglePengeluaranForm.classList.add('active');
            window.scrollTo({
                top: togglePengeluaranForm.offsetTop,
                behavior: 'smooth'
            });
        }

        function deletePengeluaran(index) {
            if (confirm("Yakin ingin menghapus data ini?")) {
                pengeluaranData.splice(index, 1);
                renderTable();
            }
        }

        function sendWA(nomor, nama) {
            const pesan = `Halo ${nama}, cucian Anda sudah selesai, cucian anda ingin kami antar atau diambil sendiri?. Mohon konfirmasinya, dan Terima kasih telah menggunakan jasa kami.`;
            window.open(`https://wa.me/${nomor}?text=${encodeURIComponent(pesan)}`, "_blank");
        }

        downloadBtn.addEventListener("click", () => {
            let csv = "No,Nama,No WA,Berat (Kg),Harga (Rp),Total,Tanggal\n";
            laundryData.forEach((d, i) => {
                // Perbaikan: Menggunakan parseFloat() untuk perhitungan CSV
                const berat = parseFloat(d.berat.toString().replace(',', '.'));
                const total = berat * d.harga;
                csv += `${i + 1},${d.nama},${d.nomor},${d.berat},${d.harga},${total},${d.tanggal}\n`;
            });

            csv += "\nData Pengeluaran\nNo,Keterangan,Total,Tanggal\n";
            pengeluaranData.forEach((d, i) => {
                csv += `${i + 1},${d.keterangan},${d.jumlah},${d.tanggal}\n`;
            });

            const blob = new Blob([csv], {
                type: "text/csv;charset=utf-8;"
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "data_laundry.csv";
            link.click();
        });

        document.addEventListener('click', function(event) {
            const target = event.target.closest('button');
            if (target && target.dataset.type === 'laundry') {
                const index = target.dataset.index;
                if (target.classList.contains('edit')) {
                    editLaundry(index);
                } else if (target.classList.contains('delete')) {
                    deleteLaundry(index);
                }
            } else if (target && target.dataset.type === 'pengeluaran') {
                const index = target.dataset.index;
                if (target.classList.contains('edit')) {
                    editPengeluaran(index);
                } else if (target.classList.contains('delete')) {
                    deletePengeluaran(index);
                }
            }
        });

        toggleLaundryForm.addEventListener('click', () => {
            laundryForm.classList.toggle('active');
            toggleLaundryForm.classList.toggle('active');
        });

        togglePengeluaranForm.addEventListener('click', () => {
            pengeluaranForm.classList.toggle('active');
            togglePengeluaranForm.classList.toggle('active');
        });

        renderTable();
    </script>
</body>

</html>